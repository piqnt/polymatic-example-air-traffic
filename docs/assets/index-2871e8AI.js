(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))n(r);new MutationObserver(r=>{for(const s of r)if(s.type==="childList")for(const o of s.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&n(o)}).observe(document,{childList:!0,subtree:!0});function i(r){const s={};return r.integrity&&(s.integrity=r.integrity),r.referrerPolicy&&(s.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?s.credentials="include":r.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function n(r){if(r.ep)return;r.ep=!0;const s=i(r);fetch(r.href,s)}})();/**
 * Polymatic v0.0.8
 * @copyright Copyright 2025 Ali Shakiba
 * @license Licensed under the MIT (https://github.com/piqnt/polymatic/blob/main/LICENSE.md)
 */function ht(e){try{const t=localStorage.getItem(e);if(t)return t}catch{}try{const t=sessionStorage.getItem(e);if(t)return t}catch{}}function F(e,t){let i=ht(e+"_exclude"),n=ht(e+"_include");try{if(i&&t.match(i))return!1}catch(r){console.log(r)}try{if(n&&t.match(n))return!0}catch(r){console.log(r)}return!1}function gt(e,t){const i=F("debug",e),n=F("trace",e);return i?(...r)=>{t&&!t(...r)||(console.log(e,...r),n&&console.trace())}:()=>{}}function Mt(e,t){const i=F("watch",e),n=F("trace",e);return i?new Proxy(t,{set(r,s,o,h){return console.debug(e,".",s.toString(),r[s],"↬",o),n&&console.trace(),Reflect.set(r,s,o,h)}}):t}const at=gt("middleware.event",e=>!(e!=null&&e.endsWith("-move")||e==="hotsyncWorld")),ut=gt("middleware.lifecycle");class X{constructor(){this.__handlers={},this.__children=[],this.__parent=null}get activated(){return this.__parent&&this.__parent.activated}use(t){this.__children.indexOf(t)===-1&&(this.activated&&t.__attach(this),this.__children.push(t))}unuse(t){const i=this.__children.indexOf(t);i!==-1&&(this.__children.splice(i,1),t==null||t.__detach())}__attach(t){if(!this.__parent){this.__parent=t,ut("activate","+",this.constructor.name),this._handle("activate");for(let i=0;i<this.__children.length;i++)this.__children[i].__attach(this)}}__detach(){if(this.__parent){ut("deactivate","-",this.constructor.name),this._handle("deactivate");for(let t=0;t<this.__children.length;t++)this.__children[t].__detach();this.__parent=null}}get context(){return this.__parent?this.__parent.context:null}setContext(t){this.__parent?this.__parent.setContext(t):console.error("Middleware is not activated")}on(t,i){if(this.__handlers[t])throw Error(`Handler for ${t} already exists`);this.__handlers[t]=i}_consume(t,i){if(this._handle(t,i))return!0;for(let r=0;r<this.__children.length;r++)if(this.__children[r]._consume(t,i))return!0;return!1}_handle(t,i){if(!this.activated)return;const n=this.__handlers&&this.__handlers[t];return!!(n&&typeof n=="function"&&(at(t,"→",this.constructor.name,i),n.call(this,i)===!0))}emit(t,i){this.activated&&(at(t,"↑",this.constructor.name,i),this.__parent?this.__parent.emit(t,i):console.error(Error("Not active!")))}static activate(t,i){return G.activate(t,i)}}class G extends X{constructor(){super(...arguments),this.__handlers={},this.__children=[],this._activated=!1,this.contextUpdateEmit=()=>{this.emit("context-change")}}get activated(){return this._activated}_activate(t){if(!this._activated){t=Mt("middleware.context",t),this._context=t,this._activated=!0,this._handle("activate");for(let i=0;i<this.__children.length;i++)this.__children[i].__attach(this)}}_deactivate(){if(this._activated){this._activated=!1,this._handle("deactivate");for(let t=0;t<this.__children.length;t++)this.__children[t].__detach()}}get context(){return this._context}setContext(t){if(typeof t!="function"){console.error("Setter is not a function: ",t);return}t(this.context),clearTimeout(this.contextUpdateEmitTimeout),this.contextUpdateEmitTimeout=setTimeout(this.contextUpdateEmit)}emit(t,i){setTimeout(()=>{this._consume(t,i)})}static activate(t,i){const n=new G;n.use(t),n._activate(i)}static deactivate(t){if("_deactivate"in t&&typeof t._deactivate=="function")return t._deactivate(),!0;const i=t.__parent;return i&&"_deactivate"in i&&typeof i._deactivate=="function"?(i._deactivate(),!0):!1}}class nt{constructor(){this._componentsById={}}static create(t){return new class extends nt{constructor(){super(...arguments),this.filter=t.filter,this.enter=t.enter,this.exit=t.exit,this.update=t.update}}}ref(t){return this._componentsById[t]}}class rt{constructor(){this._drivers=[],this._map={},this._mapBuffer={},this._updateBuffer=[],this._enterBuffer=[],this._exitBuffer=[]}static create(t){return new class extends rt{constructor(){super(...arguments),this.key=t.key}}}addDriver(t){if(!(t&&t.filter&&t.enter&&t.exit&&t.update))throw"Invalid driver: "+t;return this._drivers.push(t),this}data(t){if(!Array.isArray(t))throw"Invalid data: "+t;this._enterBuffer.length=0,this._exitBuffer.length=0,this._updateBuffer.length=t.length;for(let n=0;n<t.length;n++){const r=t[n];if(typeof r!="object"||r===null)continue;const s=this.key(r);this._map[s]?delete this._map[s]:this._enterBuffer.push(r),this._updateBuffer[n]=r,this._mapBuffer[s]=r}for(const n in this._map)this._exitBuffer.push(this._map[n]),delete this._map[n];const i=this._map;this._map=this._mapBuffer,this._mapBuffer=i;for(let n=0;n<this._exitBuffer.length;n++){const r=this._exitBuffer[n],s=this.key(r);for(const o of this._drivers){if(o.filter(r)){const h=o._componentsById[s];o.exit(r,h)}delete o._componentsById[s]}}for(let n=0;n<this._enterBuffer.length;n++){const r=this._enterBuffer[n],s=this.key(r);for(const o of this._drivers)if(o.filter(r)){const h=o.enter(r);h&&(o._componentsById[s]=h)}}for(let n=0;n<this._updateBuffer.length;n++){if(typeof t[n]!="object"||t[n]===null)continue;const r=this._updateBuffer[n],s=this.key(r);for(const o of this._drivers)if(o.filter(r)){const h=o._componentsById[s];o.update(r,h)}}this._enterBuffer.length=0,this._exitBuffer.length=0,this._updateBuffer.length=0}}/**
 * Stage.js v1.0.0-alpha.17
 * @copyright Copyright 2025 Ali Shakiba
 * @license Licensed under the MIT (https://github.com/piqnt/stage.js/blob/main/LICENSE.md)
 */var Et=Math.random,St=Math.sqrt;function Yt(e,t){return typeof e>"u"?(t=1,e=0):typeof t>"u"&&(t=e,e=0),e==t?e:Et()*(t-e)+e}function yt(e,t,i){return typeof t>"u"?(i=1,t=0):typeof i>"u"&&(i=t,t=0),i>t?(e=(e-t)%(i-t),e+(e<0?i:t)):(e=(e-i)%(t-i),e+(e<=0?t:i))}function xt(e,t,i){return e<t?t:e>i?i:e}function Xt(e,t){return St(e*e+t*t)}var S=Object.create(Math);S.random=Yt;S.wrap=yt;S.clamp=xt;S.length=Xt;S.rotate=yt;S.limit=xt;var ft=function(){function e(t,i,n,r,s,o){this.a=1,this.b=0,this.c=0,this.d=1,this.e=0,this.f=0,typeof t=="object"?this.reset(t):this.reset(t,i,n,r,s,o)}return e.prototype.toString=function(){return"["+this.a+", "+this.b+", "+this.c+", "+this.d+", "+this.e+", "+this.f+"]"},e.prototype.clone=function(){return new e(this.a,this.b,this.c,this.d,this.e,this.f)},e.prototype.reset=function(t,i,n,r,s,o){return this._dirty=!0,typeof t=="object"?(this.a=t.a,this.d=t.d,this.b=t.b,this.c=t.c,this.e=t.e,this.f=t.f):(this.a=typeof t=="number"?t:1,this.b=typeof i=="number"?i:0,this.c=typeof n=="number"?n:0,this.d=typeof r=="number"?r:1,this.e=typeof s=="number"?s:0,this.f=typeof o=="number"?o:0),this},e.prototype.identity=function(){return this._dirty=!0,this.a=1,this.b=0,this.c=0,this.d=1,this.e=0,this.f=0,this},e.prototype.rotate=function(t){if(!t)return this;this._dirty=!0;var i=t?Math.cos(t):1,n=t?Math.sin(t):0,r=i*this.a-n*this.b,s=i*this.b+n*this.a,o=i*this.c-n*this.d,h=i*this.d+n*this.c,f=i*this.e-n*this.f,a=i*this.f+n*this.e;return this.a=r,this.b=s,this.c=o,this.d=h,this.e=f,this.f=a,this},e.prototype.translate=function(t,i){return!t&&!i?this:(this._dirty=!0,this.e+=t,this.f+=i,this)},e.prototype.scale=function(t,i){return!(t-1)&&!(i-1)?this:(this._dirty=!0,this.a*=t,this.b*=i,this.c*=t,this.d*=i,this.e*=t,this.f*=i,this)},e.prototype.skew=function(t,i){if(!t&&!i)return this;this._dirty=!0;var n=this.a+this.b*t,r=this.b+this.a*i,s=this.c+this.d*t,o=this.d+this.c*i,h=this.e+this.f*t,f=this.f+this.e*i;return this.a=n,this.b=r,this.c=s,this.d=o,this.e=h,this.f=f,this},e.prototype.concat=function(t){this._dirty=!0;var i=this.a*t.a+this.b*t.c,n=this.b*t.d+this.a*t.b,r=this.c*t.a+this.d*t.c,s=this.d*t.d+this.c*t.b,o=this.e*t.a+t.e+this.f*t.c,h=this.f*t.d+t.f+this.e*t.b;return this.a=i,this.b=n,this.c=r,this.d=s,this.e=o,this.f=h,this},e.prototype.inverse=function(){if(this._dirty){this._dirty=!1,this.inverted||(this.inverted=new e);var t=this.a*this.d-this.b*this.c;this.inverted.a=this.d/t,this.inverted.b=-this.b/t,this.inverted.c=-this.c/t,this.inverted.d=this.a/t,this.inverted.e=(this.c*this.f-this.e*this.d)/t,this.inverted.f=(this.e*this.b-this.a*this.f)/t}return this.inverted},e.prototype.map=function(t,i){return i=i||{x:0,y:0},i.x=this.a*t.x+this.c*t.y+this.e,i.y=this.b*t.x+this.d*t.y+this.f,i},e.prototype.mapX=function(t,i){return typeof t=="object"&&(i=t.y,t=t.x),this.a*t+this.c*i+this.e},e.prototype.mapY=function(t,i){return typeof t=="object"&&(i=t.y,t=t.x),this.b*t+this.d*i+this.f},e}();/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */var Q=function(e,t){return Q=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(i,n){i.__proto__=n}||function(i,n){for(var r in n)n.hasOwnProperty(r)&&(i[r]=n[r])},Q(e,t)};function b(e,t){Q(e,t);function i(){this.constructor=e}e.prototype=t===null?Object.create(t):(i.prototype=t.prototype,new i)}var q=function(){return q=Object.assign||function(t){for(var i,n=1,r=arguments.length;n<r;n++){i=arguments[n];for(var s in i)Object.prototype.hasOwnProperty.call(i,s)&&(t[s]=i[s])}return t},q.apply(this,arguments)};function mt(e,t,i,n){function r(s){return s instanceof i?s:new i(function(o){o(s)})}return new(i||(i=Promise))(function(s,o){function h(p){try{a(n.next(p))}catch(u){o(u)}}function f(p){try{a(n.throw(p))}catch(u){o(u)}}function a(p){p.done?s(p.value):r(p.value).then(h,f)}a((n=n.apply(e,[])).next())})}function wt(e,t){var i={label:0,sent:function(){if(s[0]&1)throw s[1];return s[1]},trys:[],ops:[]},n,r,s,o;return o={next:h(0),throw:h(1),return:h(2)},typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function h(a){return function(p){return f([a,p])}}function f(a){if(n)throw new TypeError("Generator is already executing.");for(;i;)try{if(n=1,r&&(s=a[0]&2?r.return:a[0]?r.throw||((s=r.return)&&s.call(r),0):r.next)&&!(s=s.call(r,a[1])).done)return s;switch(r=0,s&&(a=[a[0]&2,s.value]),a[0]){case 0:case 1:s=a;break;case 4:return i.label++,{value:a[1],done:!1};case 5:i.label++,r=a[1],a=[0];continue;case 7:a=i.ops.pop(),i.trys.pop();continue;default:if(s=i.trys,!(s=s.length>0&&s[s.length-1])&&(a[0]===6||a[0]===2)){i=0;continue}if(a[0]===3&&(!s||a[1]>s[0]&&a[1]<s[3])){i.label=a[1];break}if(a[0]===6&&i.label<s[1]){i.label=s[1],s=a;break}if(s&&i.label<s[2]){i.label=s[2],i.ops.push(a);break}s[2]&&i.ops.pop(),i.trys.pop();continue}a=t.call(e,i)}catch(p){a=[6,p],r=0}finally{n=s=0}if(a[0]&5)throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}}var bt=Object.prototype.toString;function Z(e){var t=bt.call(e);return t==="[object Function]"||t==="[object GeneratorFunction]"||t==="[object AsyncFunction]"}function N(e){return bt.call(e)==="[object Object]"&&e.constructor===Object}const E={create:0,tick:0,component:0,draw:0,fps:0};var K=function(){return Date.now().toString(36)+Math.random().toString(36).slice(2)},C=function(){function e(){this.uid="texture:"+K(),this.sx=0,this.sy=0,this.dx=0,this.dy=0}return e.prototype.setSourceCoordinate=function(t,i){this.sx=t,this.sy=i},e.prototype.setSourceDimension=function(t,i){this.sw=t,this.sh=i},e.prototype.setDestinationCoordinate=function(t,i){this.dx=t,this.dy=i},e.prototype.setDestinationDimension=function(t,i){this.dw=t,this.dh=i},e.prototype.draw=function(t,i,n,r,s,o,h,f,a){var p,u,g,y,l,d,c,v;arguments.length>5?(p=this.sx+i,u=this.sy+n,g=r??this.sw,y=s??this.sh,l=this.dx+o,d=this.dy+h,c=f??this.dw,v=a??this.dh):arguments.length>1?(p=this.sx,u=this.sy,g=this.sw,y=this.sh,l=this.dx+i,d=this.dy+n,c=r??this.dw,v=s??this.dh):(p=this.sx,u=this.sy,g=this.sw,y=this.sh,l=this.dx,d=this.dy,c=this.dw,v=this.dh),this.drawWithNormalizedArgs(t,p,u,g,y,l,d,c,v)},e}(),kt=function(e){b(t,e);function t(i,n){var r=e.call(this)||this;return r._pixelRatio=1,r.padding=0,typeof i=="object"&&r.setSourceImage(i,n),r}return t.prototype.setSourceImage=function(i,n){n===void 0&&(n=1),this._source=i,this._pixelRatio=n},t.prototype.setPadding=function(i){this.padding=i},t.prototype.getWidth=function(){return this._source.width/this._pixelRatio+(this.padding+this.padding)},t.prototype.getHeight=function(){return this._source.height/this._pixelRatio+(this.padding+this.padding)},t.prototype.prerender=function(i){return!1},t.prototype.drawWithNormalizedArgs=function(i,n,r,s,o,h,f,a,p){var u=this._source;if(!(u===null||typeof u!="object")){s=s??this._source.width/this._pixelRatio,o=o??this._source.height/this._pixelRatio,a=a??s,p=p??o,h+=this.padding,f+=this.padding;var g=n*this._pixelRatio,y=r*this._pixelRatio,l=s*this._pixelRatio,d=o*this._pixelRatio;try{E.draw++,i.drawImage(u,g,y,l,d,h,f,a,p)}catch(c){this._draw_failed||(console.log("Unable to draw: ",u),console.log(c),this._draw_failed=!0)}}},t}(C),tt=function(e){b(t,e);function t(i){var n=e.call(this)||this;return n._source=i,n}return t.prototype.setSourceTexture=function(i){this._source=i},t.prototype.getWidth=function(){var i,n;return(n=(i=this.dw)!==null&&i!==void 0?i:this.sw)!==null&&n!==void 0?n:this._source.getWidth()},t.prototype.getHeight=function(){var i,n;return(n=(i=this.dh)!==null&&i!==void 0?i:this.sh)!==null&&n!==void 0?n:this._source.getHeight()},t.prototype.prerender=function(i){return this._source.prerender(i)},t.prototype.drawWithNormalizedArgs=function(i,n,r,s,o,h,f,a,p){var u=this._source;u===null||typeof u!="object"||u.draw(i,n,r,s,o,h,f,a,p)},t}(C),ct=function(e){b(t,e);function t(i){i===void 0&&(i={});var n=e.call(this)||this;return n.pipeSpriteTexture=function(r){var s=n._map,o=n._ppu,h=n._trim;if(r){r=Object.assign({},r),Z(s)&&(r=s(r)),o!=1&&(r.x*=o,r.y*=o,r.width*=o,r.height*=o,r.top*=o,r.bottom*=o,r.left*=o,r.right*=o),h!=0&&(r.x+=h,r.y+=h,r.width-=2*h,r.height-=2*h,r.top-=h,r.bottom-=h,r.left-=h,r.right-=h);var f=new tt(n);return f.top=r.top,f.bottom=r.bottom,f.left=r.left,f.right=r.right,f.setSourceCoordinate(r.x,r.y),f.setSourceDimension(r.width,r.height),f}},n.findSpriteDefinition=function(r){var s=n._textures;if(s){if(Z(s))return s(r);if(N(s))return s[r]}},n.select=function(r){if(!r)return new U(new tt(n));var s=n.findSpriteDefinition(r);if(s)return new U(s,n)},n.name=i.name,n._ppu=i.ppu||i.ratio||1,n._trim=i.trim||0,n._map=i.map||i.filter,n._textures=i.textures,typeof i.image=="object"&&N(i.image)?("src"in i.image?n._imageSrc=i.image.src:"url"in i.image&&(n._imageSrc=i.image.url),typeof i.image.ratio=="number"&&(n._pixelRatio=i.image.ratio)):(typeof i.imagePath=="string"?n._imageSrc=i.imagePath:typeof i.image=="string"&&(n._imageSrc=i.image),typeof i.imageRatio=="number"&&(n._pixelRatio=i.imageRatio)),Bt(i),n}return t.prototype.load=function(){return mt(this,void 0,void 0,function(){var i;return wt(this,function(n){switch(n.label){case 0:return this._imageSrc?[4,Rt(this._imageSrc)]:[3,2];case 1:i=n.sent(),this.setSourceImage(i,this._pixelRatio),n.label=2;case 2:return[2]}})})},t}(kt);function Rt(e){return console.debug&&console.debug("Loading image: "+e),new Promise(function(t,i){var n=new Image;n.onload=function(){console.debug&&console.debug("Image loaded: "+e),t(n)},n.onerror=function(r){console.error("Loading failed: "+e),i(r)},n.src=e})}function Bt(e){"filter"in e&&console.warn("'filter' field of atlas definition is deprecated"),"cutouts"in e&&console.warn("'cutouts' field of atlas definition is deprecated"),"sprites"in e&&console.warn("'sprites' field of atlas definition is deprecated"),"factory"in e&&console.warn("'factory' field of atlas definition is deprecated"),"ratio"in e&&console.warn("'ratio' field of atlas definition is deprecated"),"imagePath"in e&&console.warn("'imagePath' field of atlas definition is deprecated"),"imageRatio"in e&&console.warn("'imageRatio' field of atlas definition is deprecated"),typeof e.image=="object"&&"url"in e.image&&console.warn("'image.url' field of atlas definition is deprecated")}function Lt(e){return typeof e=="object"&&N(e)&&typeof e.width=="number"&&typeof e.height=="number"}var U=function(){function e(t,i){this.selection=t,this.atlas=i}return e.prototype.resolve=function(t,i){if(t){if(Array.isArray(t))return this.resolve(t[0]);if(t instanceof C)return t;if(Lt(t))return this.atlas?this.atlas.pipeSpriteTexture(t):I;if(typeof t=="object"&&N(t)&&typeof i<"u")return this.resolve(t[i]);if(typeof t=="function"&&Z(t))return this.resolve(t(i));if(typeof t=="string")return this.atlas?this.resolve(this.atlas.findSpriteDefinition(t)):I}else return I},e.prototype.one=function(t){return this.resolve(this.selection,t)},e.prototype.array=function(t){var i=Array.isArray(t)?t:[];if(Array.isArray(this.selection))for(var n=0;n<this.selection.length;n++)i[n]=this.resolve(this.selection[n]);else i[0]=this.resolve(this.selection);return i},e}(),I=new(function(e){b(t,e);function t(){var i=e.call(this)||this;return i.setSourceDimension(0,0),i}return t.prototype.getWidth=function(){return 0},t.prototype.getHeight=function(){return 0},t.prototype.prerender=function(i){return!1},t.prototype.drawWithNormalizedArgs=function(i,n,r,s,o,h,f,a,p){},t.prototype.setSourceCoordinate=function(i,n){},t.prototype.setSourceDimension=function(i,n){},t.prototype.setDestinationCoordinate=function(i,n){},t.prototype.setDestinationDimension=function(i,n){},t.prototype.draw=function(){},t}(C)),Ct=new U(I),it={},et=[];function $(e){return mt(this,void 0,void 0,function(){var t;return wt(this,function(i){switch(i.label){case 0:return e instanceof ct?t=e:t=new ct(e),t.name&&(it[t.name]=t),et.push(t),[4,t.load()];case 1:return i.sent(),[2,t]}})})}function st(e){if(typeof e!="string")return new U(e);var t=null,i=e.indexOf(":");if(i>0&&e.length>i+1){var n=it[e.slice(0,i)];t=n&&n.select(e.slice(i+1))}if(!t){var r=it[e];t=r&&r.select()}if(!t)for(var s=0;s<et.length&&(t=et[s].select(e),!t);s++);return t||(console.error("Texture not found: "+e),t=Ct),t}var H=function(e){b(t,e);function t(i,n){var r=e.call(this)||this;return r._source=i,r._resizeMode=n,r}return t.prototype.getWidth=function(){var i;return(i=this.dw)!==null&&i!==void 0?i:this._source.getWidth()},t.prototype.getHeight=function(){var i;return(i=this.dh)!==null&&i!==void 0?i:this._source.getHeight()},t.prototype.prerender=function(i){return!1},t.prototype.drawWithNormalizedArgs=function(i,n,r,s,o,h,f,a,p){var u=this._source;if(!(u===null||typeof u!="object")){var g=a,y=p,l=Number.isFinite(u.left)?u.left:0,d=Number.isFinite(u.right)?u.right:0,c=Number.isFinite(u.top)?u.top:0,v=Number.isFinite(u.bottom)?u.bottom:0,k=u.getWidth()-l-d,T=u.getHeight()-c-v;if(this._innerSize||(g=Math.max(g-l-d,0),y=Math.max(y-c-v,0)),c>0&&l>0&&u.draw(i,0,0,l,c,0,0,l,c),v>0&&l>0&&u.draw(i,0,T+c,l,v,0,y+c,l,v),c>0&&d>0&&u.draw(i,k+l,0,d,c,g+l,0,d,c),v>0&&d>0&&u.draw(i,k+l,T+c,d,v,g+l,y+c,d,v),this._resizeMode==="stretch")c>0&&u.draw(i,l,0,k,c,l,0,g,c),v>0&&u.draw(i,l,T+c,k,v,l,y+c,g,v),l>0&&u.draw(i,0,c,l,T,0,c,l,y),d>0&&u.draw(i,k+l,c,d,T,g+l,c,d,y),u.draw(i,l,c,k,T,l,c,g,y);else if(this._resizeMode==="tile")for(var R=l,D=g,A=void 0;D>0;){A=Math.min(k,D),D-=k;for(var B=c,J=y,P=void 0;J>0;)P=Math.min(T,J),J-=T,u.draw(i,l,c,A,P,R,B,A,P),D<=0&&(l&&u.draw(i,0,c,l,P,0,B,l,P),d&&u.draw(i,k+l,c,d,P,R+A,B,d,P)),B+=P;c&&u.draw(i,l,0,A,c,R,0,A,c),v&&u.draw(i,l,T+c,A,v,R,B,A,v),R+=A}}},t}(C);function lt(){return typeof window<"u"&&window.devicePixelRatio||1}function Wt(e){return e&&(e==="cover"||e==="contain"||e==="fill"||e==="in"||e==="in-pad"||e==="out"||e==="out-crop")}var _=0,Dt=function(){function e(t){this.uid="pin:"+K(),this._directionX=1,this._directionY=1,this._owner=t,this._parent=null,this._relativeMatrix=new ft,this._absoluteMatrix=new ft,this.reset()}return e.prototype.reset=function(){this._textureAlpha=1,this._alpha=1,this._width=0,this._height=0,this._scaleX=1,this._scaleY=1,this._skewX=0,this._skewY=0,this._rotation=0,this._pivoted=!1,this._pivotX=0,this._pivotY=0,this._handled=!1,this._handleX=0,this._handleY=0,this._aligned=!1,this._alignX=0,this._alignY=0,this._offsetX=0,this._offsetY=0,this._boxX=0,this._boxY=0,this._boxWidth=this._width,this._boxHeight=this._height,this._ts_translate=++_,this._ts_transform=++_,this._ts_matrix=++_},e.prototype._update=function(){return this._parent=this._owner._parent&&this._owner._parent._pin,this._handled&&this._mo_handle!=this._ts_transform&&(this._mo_handle=this._ts_transform,this._ts_translate=++_),this._aligned&&this._parent&&this._mo_align!=this._parent._ts_transform&&(this._mo_align=this._parent._ts_transform,this._ts_translate=++_),this},e.prototype.toString=function(){return this._owner+" ("+(this._parent?this._parent._owner:null)+")"},e.prototype.absoluteMatrix=function(){this._update();var t=Math.max(this._ts_transform,this._ts_translate,this._parent?this._parent._ts_matrix:0);if(this._mo_abs==t)return this._absoluteMatrix;this._mo_abs=t;var i=this._absoluteMatrix;return i.reset(this.relativeMatrix()),this._parent&&i.concat(this._parent._absoluteMatrix),this._ts_matrix=++_,i},e.prototype.relativeMatrix=function(){this._update();var t=Math.max(this._ts_transform,this._ts_translate,this._parent?this._parent._ts_transform:0);if(this._mo_rel==t)return this._relativeMatrix;this._mo_rel=t;var i=this._relativeMatrix;if(i.identity(),this._pivoted&&i.translate(-this._pivotX*this._width,-this._pivotY*this._height),i.scale(this._scaleX*this._directionX,this._scaleY*this._directionY),i.skew(this._skewX,this._skewY),i.rotate(this._rotation),this._pivoted&&i.translate(this._pivotX*this._width,this._pivotY*this._height),this._pivoted)this._boxX=0,this._boxY=0,this._boxWidth=this._width,this._boxHeight=this._height;else{var n=void 0,r=void 0;i.a>0&&i.c>0||i.a<0&&i.c<0?(n=0,r=i.a*this._width+i.c*this._height):(n=i.a*this._width,r=i.c*this._height),n>r?(this._boxX=r,this._boxWidth=n-r):(this._boxX=n,this._boxWidth=r-n),i.b>0&&i.d>0||i.b<0&&i.d<0?(n=0,r=i.b*this._width+i.d*this._height):(n=i.b*this._width,r=i.d*this._height),n>r?(this._boxY=r,this._boxHeight=n-r):(this._boxY=n,this._boxHeight=r-n)}return this._x=this._offsetX,this._y=this._offsetY,this._x-=this._boxX+this._handleX*this._boxWidth*this._directionX,this._y-=this._boxY+this._handleY*this._boxHeight*this._directionY,this._aligned&&this._parent&&(this._parent.relativeMatrix(),this._x+=this._alignX*this._parent._width,this._y+=this._alignY*this._parent._height),i.translate(this._x,this._y),this._relativeMatrix},e.prototype.get=function(t){if(typeof pt[t]=="function")return pt[t](this)},e.prototype.set=function(t,i){if(typeof t=="string")typeof O[t]=="function"&&typeof i<"u"&&O[t](this,i);else if(typeof t=="object")for(i in t)typeof O[i]=="function"&&typeof t[i]<"u"&&O[i](this,t[i],t);return this._owner&&(this._owner._ts_pin=++_,this._owner.touch()),this},e.prototype.fit=function(t,i,n){this._ts_transform=++_,n==="contain"&&(n="in-pad"),n==="cover"&&(n="out-crop"),typeof t=="number"&&(this._scaleX=t/this._unscaled_width,this._width=this._unscaled_width),typeof i=="number"&&(this._scaleY=i/this._unscaled_height,this._height=this._unscaled_height),typeof t=="number"&&typeof i=="number"&&typeof n=="string"&&(n==="fill"||(n==="out"||n==="out-crop"?this._scaleX=this._scaleY=Math.max(this._scaleX,this._scaleY):(n==="in"||n==="in-pad")&&(this._scaleX=this._scaleY=Math.min(this._scaleX,this._scaleY))),(n==="out-crop"||n==="in-pad")&&(this._width=t/this._scaleX,this._height=i/this._scaleY))},e}(),pt={alpha:function(e){return e._alpha},textureAlpha:function(e){return e._textureAlpha},width:function(e){return e._width},height:function(e){return e._height},boxWidth:function(e){return e._boxWidth},boxHeight:function(e){return e._boxHeight},scaleX:function(e){return e._scaleX},scaleY:function(e){return e._scaleY},skewX:function(e){return e._skewX},skewY:function(e){return e._skewY},rotation:function(e){return e._rotation},pivotX:function(e){return e._pivotX},pivotY:function(e){return e._pivotY},offsetX:function(e){return e._offsetX},offsetY:function(e){return e._offsetY},alignX:function(e){return e._alignX},alignY:function(e){return e._alignY},handleX:function(e){return e._handleX},handleY:function(e){return e._handleY}},O={alpha:function(e,t){e._alpha=t},textureAlpha:function(e,t){e._textureAlpha=t},width:function(e,t){e._unscaled_width=t,e._width=t,e._ts_transform=++_},height:function(e,t){e._unscaled_height=t,e._height=t,e._ts_transform=++_},scale:function(e,t){e._scaleX=t,e._scaleY=t,e._ts_transform=++_},scaleX:function(e,t){e._scaleX=t,e._ts_transform=++_},scaleY:function(e,t){e._scaleY=t,e._ts_transform=++_},skew:function(e,t){e._skewX=t,e._skewY=t,e._ts_transform=++_},skewX:function(e,t){e._skewX=t,e._ts_transform=++_},skewY:function(e,t){e._skewY=t,e._ts_transform=++_},rotation:function(e,t){e._rotation=t,e._ts_transform=++_},pivot:function(e,t){e._pivotX=t,e._pivotY=t,e._pivoted=!0,e._ts_transform=++_},pivotX:function(e,t){e._pivotX=t,e._pivoted=!0,e._ts_transform=++_},pivotY:function(e,t){e._pivotY=t,e._pivoted=!0,e._ts_transform=++_},offset:function(e,t){e._offsetX=t,e._offsetY=t,e._ts_translate=++_},offsetX:function(e,t){e._offsetX=t,e._ts_translate=++_},offsetY:function(e,t){e._offsetY=t,e._ts_translate=++_},align:function(e,t){this.alignX(e,t),this.alignY(e,t)},alignX:function(e,t){e._alignX=t,e._aligned=!0,e._ts_translate=++_,this.handleX(e,t)},alignY:function(e,t){e._alignY=t,e._aligned=!0,e._ts_translate=++_,this.handleY(e,t)},handle:function(e,t){this.handleX(e,t),this.handleY(e,t)},handleX:function(e,t){e._handleX=t,e._handled=!0,e._ts_translate=++_},handleY:function(e,t){e._handleY=t,e._handled=!0,e._ts_translate=++_},resizeMode:function(e,t,i){i&&(t=="in"?t="in-pad":t=="out"&&(t="out-crop"),e.fit(i.resizeWidth,i.resizeHeight,t))},resizeWidth:function(e,t,i){(!i||!i.resizeMode)&&e.fit(t,null)},resizeHeight:function(e,t,i){(!i||!i.resizeMode)&&e.fit(null,t)},scaleMode:function(e,t,i){i&&e.fit(i.scaleWidth,i.scaleHeight,t)},scaleWidth:function(e,t,i){(!i||!i.scaleMode)&&e.fit(t,null)},scaleHeight:function(e,t,i){(!i||!i.scaleMode)&&e.fit(null,t)},matrix:function(e,t){this.scaleX(e,t.a),this.skewX(e,t.c/t.d),this.skewY(e,t.b/t.a),this.scaleY(e,t.d),this.offsetX(e,t.e),this.offsetY(e,t.f),this.rotation(e,0)}};function Ht(e){return e}var _t={},Tt={},At={},Ot=function(){function e(){}return e.get=function(t,i){if(i=i||Ht,typeof t=="function")return t;if(typeof t!="string")return i;var n=_t[t];if(n)return n;var r=/^(\w+)(-(in|out|in-out|out-in))?(\((.*)\))?$/i.exec(t);if(!r||!r.length)return i;var s=r[1],o=At[s],h=r[3],f=Tt[h],a=r[5];if(!o)n=i;else if("fn"in o&&typeof o.fn=="function")n=o.fn;else if("fc"in o&&typeof o.fc=="function"){var p=a?a.replace(/\s+/,"").split(","):void 0;n=o.fc.apply(o.fc,p)}else n=i;return f&&(n=f(n)),_t[t]=n,n},e}();function V(e,t){Tt[e]=t}function m(e){for(var t=e.name.split(/\s+/),i=0;i<t.length;i++){var n=t[i];n&&(At[n]=e)}}V("in",function(e){return e});V("out",function(e){return function(t){return 1-e(1-t)}});V("in-out",function(e){return function(t){return t<.5?e(2*t)/2:1-e(2*(1-t))/2}});V("out-in",function(e){return function(t){return t<.5?1-e(2*(1-t))/2:e(2*t)/2}});m({name:"linear",fn:function(e){return e}});m({name:"quad",fn:function(e){return e*e}});m({name:"cubic",fn:function(e){return e*e*e}});m({name:"quart",fn:function(e){return e*e*e*e}});m({name:"quint",fn:function(e){return e*e*e*e*e}});m({name:"sin sine",fn:function(e){return 1-Math.cos(e*Math.PI/2)}});m({name:"exp expo",fn:function(e){return e==0?0:Math.pow(2,10*(e-1))}});m({name:"circle circ",fn:function(e){return 1-Math.sqrt(1-e*e)}});m({name:"bounce",fn:function(e){return e<1/2.75?7.5625*e*e:e<2/2.75?7.5625*(e-=1.5/2.75)*e+.75:e<2.5/2.75?7.5625*(e-=2.25/2.75)*e+.9375:7.5625*(e-=2.625/2.75)*e+.984375}});m({name:"poly",fc:function(e){return function(t){return Math.pow(t,e)}}});m({name:"elastic",fc:function(e,t){t=t||.45,e=e||1;var i=t/(2*Math.PI)*Math.asin(1/e);return function(n){return 1+e*Math.pow(2,-10*n)*Math.sin((n-i)*(2*Math.PI)/t)}}});m({name:"back",fc:function(e){return e=typeof e<"u"?e:1.70158,function(t){return t*t*((e+1)*t-e)}}});var zt=function(){function e(t,i){i===void 0&&(i={}),this.uid="transition:"+K(),this._ending=[],this._end={},this._duration=i.duration||400,this._delay=i.delay||0,this._owner=t,this._time=0}return e.prototype.tick=function(t,i,n,r){if(this._time+=i,!(this._time<this._delay)){var s=this._time-this._delay;if(!this._start){this._start={};for(var o in this._end)this._start[o]=this._owner.pin(o)}var h=Math.min(s/this._duration,1),f=h>=1;typeof this._easing=="function"&&(h=this._easing(h));var a=1-h;for(var o in this._end)this._owner.pin(o,this._start[o]*a+this._end[o]*h);return f}},e.prototype.finish=function(){var t=this;return this._ending.forEach(function(i){try{i.call(t._owner)}catch(n){console.error(n)}}),this._next},e.prototype.tween=function(t,i){var n;return typeof t=="object"&&t!==null?n=t:(n={},typeof t=="number"&&(n.duration=t,typeof i=="number"&&(n.delay=i))),this._next=new e(this._owner,n)},e.prototype.duration=function(t){return this._duration=t,this},e.prototype.delay=function(t){return this._delay=t,this},e.prototype.ease=function(t){return this._easing=Ot.get(t),this},e.prototype.done=function(t){return this._ending.push(t),this},e.prototype.hide=function(){return this._ending.push(function(){this.hide()}),this._hide=!0,this},e.prototype.remove=function(){return this._ending.push(function(){this.remove()}),this._remove=!0,this},e.prototype.pin=function(t,i){if(typeof t=="object")for(var n in t)dt(this._owner,this._end,n,t[n]);else typeof i<"u"&&dt(this._owner,this._end,t,i);return this},e.prototype.then=function(t){return this.done(t),this},e.prototype.clear=function(t){return this},e.prototype.size=function(t,i){return this.pin("width",t),this.pin("height",i),this},e.prototype.width=function(t){return typeof t>"u"?this.pin("width"):(this.pin("width",t),this)},e.prototype.height=function(t){return typeof t>"u"?this.pin("height"):(this.pin("height",t),this)},e.prototype.offset=function(t,i){return typeof t=="object"&&(i=t.y,t=t.x),this.pin("offsetX",t),this.pin("offsetY",i),this},e.prototype.rotate=function(t){return this.pin("rotation",t),this},e.prototype.skew=function(t,i){return typeof t=="object"?(i=t.y,t=t.x):typeof i>"u"&&(i=t),this.pin("skewX",t),this.pin("skewY",i),this},e.prototype.scale=function(t,i){return typeof t=="object"?(i=t.y,t=t.x):typeof i>"u"&&(i=t),this.pin("scaleX",t),this.pin("scaleY",i),this},e.prototype.alpha=function(t,i){return this.pin("alpha",t),typeof i<"u"&&this.pin("textureAlpha",i),this},e}();function dt(e,t,i,n){typeof e.pin(i)=="number"?t[i]=n:typeof e.pin(i+"X")=="number"&&typeof e.pin(i+"Y")=="number"&&(t[i+"X"]=n,t[i+"Y"]=n)}var x=0;E.create=0;function w(e){if(e&&e instanceof W)return e;throw"Invalid component: "+e}var W=function(){function e(){var t=this;this.uid="component:"+K(),this._label="",this._parent=null,this._next=null,this._prev=null,this._first=null,this._last=null,this._visible=!0,this._alpha=1,this._padding=0,this._spacing=0,this._pin=new Dt(this),this._listeners={},this._attrs={},this._flags={},this._transitions=[],this._tickBefore=[],this._tickAfter=[],this.MAX_ELAPSE=1/0,this.renderedBefore=!1,this._transitionTickInitied=!1,this._transitionTickLastTime=0,this._transitionTick=function(i,n,r){if(!t._transitions.length)return!1;var s=t._transitionTickLastTime!==r;if(t._transitionTickLastTime=n,s)return!0;var o=t._transitions[0],h=o.tick(t,i,n,r);if(h){o===t._transitions[0]&&t._transitions.shift();var f=o.finish();f&&t._transitions.unshift(f)}return!0},E.create++,this instanceof e&&this.label(this.constructor.name)}return e.prototype.matrix=function(t){return t===void 0&&(t=!1),t===!0?this._pin.relativeMatrix():this._pin.absoluteMatrix()},e.prototype.getPixelRatio=function(){var t,i=(t=this._parent)===null||t===void 0?void 0:t.matrix(),n=i?Math.max(Math.abs(i.a),Math.abs(i.b))/lt():1;return n},e.prototype.getDevicePixelRatio=function(){var t,i=(t=this._parent)===null||t===void 0?void 0:t.matrix(),n=i?Math.max(Math.abs(i.a),Math.abs(i.b)):1;return n},e.prototype.getLogicalPixelRatio=function(){return this.getDevicePixelRatio()/lt()},e.prototype.pin=function(t,i){if(typeof t=="object")return this._pin.set(t),this;if(typeof t=="string")return typeof i>"u"?this._pin.get(t):(this._pin.set(t,i),this);if(typeof t>"u")return this._pin},e.prototype.fit=function(t,i,n){return typeof t=="object"&&(n=i,i=t.y,t=t.x),this._pin.fit(t,i,n),this},e.prototype.scaleTo=function(t,i,n){return this.fit(t,i,n)},e.prototype.toString=function(){return"["+this._label+"]"},e.prototype.id=function(t){return typeof t>"u"?this._label:(this._label=t,this)},e.prototype.label=function(t){return typeof t>"u"?this._label:(this._label=t,this)},e.prototype.attr=function(t,i){return typeof i>"u"?this._attrs!==null?this._attrs[t]:void 0:((this._attrs!==null?this._attrs:this._attrs={})[t]=i,this)},e.prototype.visible=function(t){return typeof t>"u"?this._visible:(this._visible=t,this._parent&&(this._parent._ts_children=++x),this._ts_pin=++x,this.touch(),this)},e.prototype.hide=function(){return this.visible(!1),this},e.prototype.show=function(){return this.visible(!0),this},e.prototype.parent=function(){return this._parent},e.prototype.next=function(t){for(var i=this._next;i&&t&&!i._visible;)i=i._next;return i},e.prototype.prev=function(t){for(var i=this._prev;i&&t&&!i._visible;)i=i._prev;return i},e.prototype.first=function(t){for(var i=this._first;i&&t&&!i._visible;)i=i._next;return i},e.prototype.last=function(t){for(var i=this._last;i&&t&&!i._visible;)i=i._prev;return i},e.prototype.visit=function(t,i){var n=t.reverse,r=t.visible;if(!(t.start&&t.start(this,i))){for(var s,o=n?this.last(r):this.first(r);s=o;)if(o=n?s.prev(r):s.next(r),s.visit(t,i))return!0;return t.end&&t.end(this,i)}},e.prototype.append=function(t,i){if(Array.isArray(t))for(var n=0;n<t.length;n++)e.append(this,t[n]);else if(typeof i<"u")for(var n=0;n<arguments.length;n++)e.append(this,arguments[n]);else typeof t<"u"&&e.append(this,t);return this},e.prototype.prepend=function(t,i){if(Array.isArray(t))for(var n=t.length-1;n>=0;n--)e.prepend(this,t[n]);else if(typeof i<"u")for(var n=arguments.length-1;n>=0;n--)e.prepend(this,arguments[n]);else typeof t<"u"&&e.prepend(this,t);return this},e.prototype.appendTo=function(t){return e.append(t,this),this},e.prototype.prependTo=function(t){return e.prepend(t,this),this},e.prototype.insertNext=function(t,i){if(Array.isArray(t))for(var n=0;n<t.length;n++)e.insertAfter(t[n],this);else if(typeof i<"u")for(var n=0;n<arguments.length;n++)e.insertAfter(arguments[n],this);else typeof t<"u"&&e.insertAfter(t,this);return this},e.prototype.insertPrev=function(t,i){if(Array.isArray(t))for(var n=t.length-1;n>=0;n--)e.insertBefore(t[n],this);else if(typeof i<"u")for(var n=arguments.length-1;n>=0;n--)e.insertBefore(arguments[n],this);else typeof t<"u"&&e.insertBefore(t,this);return this},e.prototype.insertAfter=function(t){return e.insertAfter(this,t),this},e.prototype.insertBefore=function(t){return e.insertBefore(this,t),this},e.append=function(t,i){w(i),w(t),i.remove(),t._last&&(t._last._next=i,i._prev=t._last),i._parent=t,t._last=i,t._first||(t._first=i),i._parent._flag(i,!0),i._ts_parent=++x,t._ts_children=++x,t.touch()},e.prepend=function(t,i){w(i),w(t),i.remove(),t._first&&(t._first._prev=i,i._next=t._first),i._parent=t,t._first=i,t._last||(t._last=i),i._parent._flag(i,!0),i._ts_parent=++x,t._ts_children=++x,t.touch()},e.insertBefore=function(t,i){w(t),w(i),t.remove();var n=i._parent,r=i._prev;n&&(i._prev=t,r&&(r._next=t)||n&&(n._first=t),t._parent=n,t._prev=r,t._next=i,t._parent._flag(t,!0),t._ts_parent=++x,t.touch())},e.insertAfter=function(t,i){w(t),w(i),t.remove();var n=i._parent,r=i._next;n&&(i._next=t,r&&(r._prev=t)||n&&(n._last=t),t._parent=n,t._prev=i,t._next=r,t._parent._flag(t,!0),t._ts_parent=++x,t.touch())},e.prototype.remove=function(t,i){if(typeof t<"u"){if(Array.isArray(t))for(var n=0;n<t.length;n++)w(t[n]).remove();else if(typeof i<"u")for(var n=0;n<arguments.length;n++)w(arguments[n]).remove();else w(t).remove();return this}return this._prev&&(this._prev._next=this._next),this._next&&(this._next._prev=this._prev),this._parent&&(this._parent._first===this&&(this._parent._first=this._next),this._parent._last===this&&(this._parent._last=this._prev),this._parent._flag(this,!1),this._parent._ts_children=++x,this._parent.touch()),this._prev=this._next=this._parent=null,this._ts_parent=++x,this},e.prototype.empty=function(){for(var t=null,i=this._first;t=i;)i=t._next,t._prev=t._next=t._parent=null,this._flag(t,!1);return this._first=this._last=null,this._ts_children=++x,this.touch(),this},e.prototype.touch=function(){return this._ts_touch=++x,this._parent&&this._parent.touch(),this},e.prototype._flag=function(t,i){if(typeof i>"u")return this._flags!==null&&this._flags[t]||0;if(typeof t=="string"&&(i?(this._flags=this._flags||{},!this._flags[t]&&this._parent&&this._parent._flag(t,!0),this._flags[t]=(this._flags[t]||0)+1):this._flags&&this._flags[t]>0&&(this._flags[t]==1&&this._parent&&this._parent._flag(t,!1),this._flags[t]=this._flags[t]-1)),typeof t=="object"&&t._flags)for(var n in t._flags)t._flags[n]>0&&this._flag(n,i);return this},e.prototype.hitTest=function(t){var i=this._pin._width,n=this._pin._height;return t.x>=0&&t.x<=i&&t.y>=0&&t.y<=n},e.prototype.prerender=function(){if(this._visible){this.prerenderTexture();for(var t,i=this._first;t=i;)i=t._next,t.prerender()}},e.prototype.prerenderTexture=function(){},e.prototype.render=function(t){if(this._visible){E.component++;var i=this.matrix();t.setTransform(i.a,i.b,i.c,i.d,i.e,i.f),this._alpha=this._pin._alpha*(this._parent?this._parent._alpha:1);var n=this._pin._textureAlpha*this._alpha;t.globalAlpha!=n&&(t.globalAlpha=n),this.renderedBefore||this.prerenderTexture(),this.renderedBefore=!0,this.renderTexture(t),t.globalAlpha!=this._alpha&&(t.globalAlpha=this._alpha);for(var r,s=this._first;r=s;)s=r._next,r.render(t)}},e.prototype.renderTexture=function(t){},e.prototype._tick=function(t,i,n){if(this._visible){t>this.MAX_ELAPSE&&(t=this.MAX_ELAPSE);var r=!1;if(this._tickBefore!==null)for(var s=0;s<this._tickBefore.length;s++){E.tick++;var o=this._tickBefore[s];r=o.call(this,t,i,n)===!0||r}for(var h,f=this._first;h=f;)f=h._next,h._flag("_tick")&&(r=h._tick(t,i,n)===!0?!0:r);if(this._tickAfter!==null)for(var s=0;s<this._tickAfter.length;s++){E.tick++;var o=this._tickAfter[s];r=o.call(this,t,i,n)===!0||r}return r}},e.prototype.tick=function(t,i){var n,r;if(i===void 0&&(i=!1),typeof t=="function"){i?(this._tickBefore===null&&(this._tickBefore=[]),this._tickBefore.push(t)):(this._tickAfter===null&&(this._tickAfter=[]),this._tickAfter.push(t));var s=((n=this._tickAfter)===null||n===void 0?void 0:n.length)>0||((r=this._tickBefore)===null||r===void 0?void 0:r.length)>0;this._flag("_tick",s)}},e.prototype.untick=function(t){if(typeof t=="function"){var i;this._tickBefore!==null&&(i=this._tickBefore.indexOf(t))>=0&&this._tickBefore.splice(i,1),this._tickAfter!==null&&(i=this._tickAfter.indexOf(t))>=0&&this._tickAfter.splice(i,1)}},e.prototype.timeout=function(t,i){this.setTimeout(t,i)},e.prototype.setTimeout=function(t,i){function n(r){if((i-=r)<0)this.untick(n),t.call(this);else return!0}return this.tick(n),n},e.prototype.clearTimeout=function(t){this.untick(t)},e.prototype.on=function(t,i){if(!t||!t.length||typeof i!="function")return this;if(typeof t!="string"&&typeof t.join=="function")for(var n=0;n<t.length;n++)this.on(t[n],i);else if(typeof t=="string"&&t.indexOf(" ")>-1){t=t.match(/\S+/g);for(var n=0;n<t.length;n++)this._on(t[n],i)}else typeof t=="string"&&this._on(t,i);return this},e.prototype._on=function(t,i){typeof t!="string"&&typeof i!="function"||(this._listeners[t]=this._listeners[t]||[],this._listeners[t].push(i),this._flag(t,!0))},e.prototype.off=function(t,i){if(!t||!t.length||typeof i!="function")return this;if(typeof t!="string"&&typeof t.join=="function")for(var n=0;n<t.length;n++)this.off(t[n],i);else if(typeof t=="string"&&t.indexOf(" ")>-1){t=t.match(/\S+/g);for(var n=0;n<t.length;n++)this._off(t[n],i)}else typeof t=="string"&&this._off(t,i);return this},e.prototype._off=function(t,i){if(!(typeof t!="string"&&typeof i!="function")){var n=this._listeners[t];if(!(!n||!n.length)){var r=n.indexOf(i);r>=0&&(n.splice(r,1),this._flag(t,!1))}}},e.prototype.listeners=function(t){return this._listeners[t]},e.prototype.publish=function(t,i){var n=this.listeners(t);if(!n||!n.length)return 0;for(var r=0;r<n.length;r++)n[r].apply(this,i);return n.length},e.prototype.trigger=function(t,i){return this.publish(t,i),this},e.prototype.size=function(t,i){return this.pin("width",t),this.pin("height",i),this},e.prototype.width=function(t){return typeof t>"u"?this.pin("width"):(this.pin("width",t),this)},e.prototype.height=function(t){return typeof t>"u"?this.pin("height"):(this.pin("height",t),this)},e.prototype.offset=function(t,i){return typeof t=="object"&&(i=t.y,t=t.x),this.pin("offsetX",t),this.pin("offsetY",i),this},e.prototype.rotate=function(t){return this.pin("rotation",t),this},e.prototype.skew=function(t,i){return typeof t=="object"?(i=t.y,t=t.x):typeof i>"u"&&(i=t),this.pin("skewX",t),this.pin("skewY",i),this},e.prototype.scale=function(t,i){return typeof t=="object"?(i=t.y,t=t.x):typeof i>"u"&&(i=t),this.pin("scaleX",t),this.pin("scaleY",i),this},e.prototype.alpha=function(t,i){return this.pin("alpha",t),typeof i<"u"&&this.pin("textureAlpha",i),this},e.prototype.tween=function(t,i,n){var r;typeof t=="object"&&t!==null?r=t:(r={},typeof t=="number"?(r.duration=t,typeof i=="number"?(r.delay=i,typeof n=="boolean"&&(r.append=n)):typeof i=="boolean"&&(r.append=i)):typeof t=="boolean"&&(r.append=t)),this._transitionTickInitied||(this.tick(this._transitionTick,!0),this._transitionTickInitied=!0),this.touch(),r.append||(this._transitions.length=0);var s=new zt(this,r);return this._transitions.push(s),s},e.prototype.row=function(t){return this.align("row",t),this},e.prototype.column=function(t){return this.align("column",t),this},e.prototype.align=function(t,i){var n=this;return this._padding=this._padding,this._spacing=this._spacing,this._layoutTicker&&this.untick(this._layoutTicker),this.tick(this._layoutTicker=function(){if(n._mo_seq!=n._ts_touch){n._mo_seq=n._ts_touch;var r=n._mo_seqAlign!=n._ts_children;n._mo_seqAlign=n._ts_children;for(var s=0,o=0,h,f=n.first(!0),a=!0;h=f;){f=h.next(!0),h.matrix(!0);var p=h.pin("boxWidth"),u=h.pin("boxHeight");t=="column"?(!a&&(o+=n._spacing),h.pin("offsetY")!=o&&h.pin("offsetY",o),s=Math.max(s,p),o=o+u,r&&h.pin("alignX",i)):t=="row"&&(!a&&(s+=n._spacing),h.pin("offsetX")!=s&&h.pin("offsetX",s),s=s+p,o=Math.max(o,u),r&&h.pin("alignY",i)),a=!1}s+=2*n._padding,o+=2*n._padding,n.pin("width")!=s&&n.pin("width",s),n.pin("height")!=o&&n.pin("height",o)}}),this},e.prototype.box=function(){return this.minimize()},e.prototype.layer=function(){return this.maximize()},e.prototype.minimize=function(){var t=this;return this._padding=this._padding,this._layoutTicker&&this.untick(this._layoutTicker),this.tick(this._layoutTicker=function(){if(t._mo_box!=t._ts_touch){t._mo_box=t._ts_touch;for(var i=0,n=0,r,s=t.first(!0);r=s;){s=r.next(!0),r.matrix(!0);var o=r.pin("boxWidth"),h=r.pin("boxHeight");i=Math.max(i,o),n=Math.max(n,h)}i+=2*t._padding,n+=2*t._padding,t.pin("width")!=i&&t.pin("width",i),t.pin("height")!=n&&t.pin("height",n)}}),this},e.prototype.maximize=function(){var t=this;return this._layoutTicker&&this.untick(this._layoutTicker),this.tick(this._layoutTicker=function(){var i=t.parent();if(i){var n=i.pin("width");t.pin("width")!=n&&t.pin("width",n);var r=i.pin("height");t.pin("height")!=r&&t.pin("height",r)}},!0),this},e.prototype.padding=function(t){return this._padding=t,this},e.prototype.spacing=function(t){return this._spacing=t,this},e}();function z(e){var t=new jt;return e&&t.texture(e),t}var jt=function(e){b(t,e);function t(){var i=e.call(this)||this;return i._texture=null,i._image=null,i._tiled=!1,i._stretched=!1,i.prerenderContext={},i.label("Sprite"),i}return t.prototype.texture=function(i){return this._image=st(i).one(),this._image?(this.pin("width",this._image.getWidth()),this.pin("height",this._image.getHeight()),this._tiled?this._texture=new H(this._image,"tile"):this._stretched?this._texture=new H(this._image,"stretch"):this._texture=new tt(this._image)):(this.pin("width",0),this.pin("height",0),this._texture=null),this},t.prototype.image=function(i){return this.texture(i)},t.prototype.tile=function(i){this._tiled=!0;var n=new H(this._image,"tile");return this._texture=n,this},t.prototype.stretch=function(i){this._stretched=!0;var n=new H(this._image,"stretch");return this._texture=n,this},t.prototype.prerenderTexture=function(){if(this._image){var i=this.getDevicePixelRatio();this.prerenderContext.pixelRatio=i;var n=this._image.prerender(this.prerenderContext);if(n===!0){var r=this._image.getWidth(),s=this._image.getHeight();this.size(r,s)}}},t.prototype.renderTexture=function(i){this._texture&&(this._texture._resizeMode&&(this._texture.dw=this.pin("width"),this._texture.dh=this.pin("height")),this._texture.draw(i))},t}(W);(function(e){b(t,e);function t(){var i=e.call(this,document.createElement("canvas"))||this;return i._lastPixelRatio=0,i}return t.prototype.setSize=function(i,n,r){r===void 0&&(r=1),this._source.width=i*r,this._source.height=n*r,this._pixelRatio=r},t.prototype.getContext=function(i,n){return i===void 0&&(i="2d"),this._source.getContext(i,n)},t.prototype.getDevicePixelRatio=function(){return this._lastPixelRatio},t.prototype.getOptimalPixelRatio=function(){return this.getDevicePixelRatio()},t.prototype.setMemoizer=function(i){this._memoizer=i},t.prototype.setDrawer=function(i){this._drawer=i},t.prototype.prerender=function(i){var n=i.pixelRatio,r=this._lastPixelRatio,s=r/n,o=r===0||s>1.25||s<.8;o&&(this._lastPixelRatio=n);var h=this._memoizer?this._memoizer.call(this):null,f=this._lastMemoKey!==h;if(o||f)return this._lastMemoKey=h,this._lastPixelRatio=n,typeof this._drawer=="function"&&this._drawer.call(this),!0},t.prototype.size=function(i,n,r){return this.setSize(i,n,r),this},t.prototype.context=function(i,n){return i===void 0&&(i="2d"),this.getContext(i,n)},t.prototype.canvas=function(i){return typeof i=="function"?i.call(this,this.getContext()):typeof i>"u"&&typeof this._drawer=="function"&&this._drawer.call(this),this},t})(kt);var It=function(){function e(){}return e.prototype.clone=function(t){return t?(t.x=this.x,t.y=this.y):t={x:this.x,y:this.y},t},e.prototype.toString=function(){return(this.x|0)+"x"+(this.y|0)},e}(),Ft=function(){function e(){this.abs=new It}return e.prototype.clone=function(t){return t?(t.x=this.x,t.y=this.y):t={x:this.x,y:this.y},t},e.prototype.toString=function(){return this.type+": "+(this.x|0)+"x"+(this.y|0)},e}(),Nt=function(){function e(){this.type="",this.x=0,this.y=0,this.timeStamp=-1,this.event=null,this.root=null,this.collected=null}return e.prototype.toString=function(){return this.type+": "+(this.x|0)+"x"+(this.y|0)},e}(),M=new Ft,j=new Nt,Ut=function(){function e(){var t=this;this.ratio=1,this.clickList=[],this.cancelList=[],this.handleStart=function(i){e.DEBUG&&console.debug&&console.debug("pointer-start",i.type),i.preventDefault(),t.localPoint(i),t.dispatchEvent(i.type,i),t.findTargets("click",t.clickList),t.findTargets("mousecancel",t.cancelList)},this.handleMove=function(i){i.preventDefault(),t.localPoint(i),t.dispatchEvent(i.type,i)},this.handleEnd=function(i){var n;i.preventDefault(),e.DEBUG&&console.debug&&console.debug("pointer-end",i.type),t.dispatchEvent(i.type,i),t.clickList.length&&(e.DEBUG&&console.debug&&console.debug("pointer-click: ",i.type,(n=t.clickList)===null||n===void 0?void 0:n.length),t.dispatchEvent("click",i,t.clickList)),t.cancelList.length=0},this.handleCancel=function(i){var n;t.cancelList.length&&(e.DEBUG&&console.debug&&console.debug("pointer-cancel",i.type,(n=t.clickList)===null||n===void 0?void 0:n.length),t.dispatchEvent("mousecancel",i,t.cancelList)),t.clickList.length=0},this.visitStart=function(i,n){return!i._flag(n.type)},this.visitEnd=function(i,n){M.raw=n.event,M.type=n.type,M.timeStamp=n.timeStamp,M.abs.x=n.x,M.abs.y=n.y;var r=i.listeners(n.type);if(r){i.matrix().inverse().map(n,M);var s=i===n.root||i.attr("spy")||i.hitTest(M);if(s&&(n.collected&&n.collected.push(i),n.event)){for(var o=!1,h=0;h<r.length;h++)o=r[h].call(i,M)?!0:o;return o}}}}return e.prototype.mount=function(t,i){var n=this;return this.stage=t,this.elem=i,this.ratio=t.viewport().ratio||1,t.on("viewport",function(r){var s;n.ratio=(s=r.ratio)!==null&&s!==void 0?s:n.ratio}),i.addEventListener("touchstart",this.handleStart),i.addEventListener("touchend",this.handleEnd),i.addEventListener("touchmove",this.handleMove),i.addEventListener("touchcancel",this.handleCancel),i.addEventListener("mousedown",this.handleStart),i.addEventListener("mouseup",this.handleEnd),i.addEventListener("mousemove",this.handleMove),document.addEventListener("mouseup",this.handleCancel),window.addEventListener("blur",this.handleCancel),this},e.prototype.unmount=function(){var t=this.elem;return t.removeEventListener("touchstart",this.handleStart),t.removeEventListener("touchend",this.handleEnd),t.removeEventListener("touchmove",this.handleMove),t.removeEventListener("touchcancel",this.handleCancel),t.removeEventListener("mousedown",this.handleStart),t.removeEventListener("mouseup",this.handleEnd),t.removeEventListener("mousemove",this.handleMove),document.removeEventListener("mouseup",this.handleCancel),window.removeEventListener("blur",this.handleCancel),this},e.prototype.localPoint=function(t){var i,n=this.elem,r,s;!((i=t.touches)===null||i===void 0)&&i.length?(r=t.touches[0].clientX,s=t.touches[0].clientY):(r=t.clientX,s=t.clientY);var o=n.getBoundingClientRect();r-=o.left,s-=o.top,r-=n.clientLeft|0,s-=n.clientTop|0,j.x=r*this.ratio,j.y=s*this.ratio},e.prototype.findTargets=function(t,i){var n=j;n.type=t,n.root=this.stage,n.event=null,n.collected=i,n.collected.length=0,this.stage.visit({reverse:!0,visible:!0,start:this.visitStart,end:this.visitEnd},n)},e.prototype.dispatchEvent=function(t,i,n){var r=j;if(r.type=t,r.root=this.stage,r.event=i,r.timeStamp=Date.now(),r.collected=null,t!=="mousemove"&&t!=="touchmove"&&e.DEBUG&&console.debug&&console.debug("pointer:dispatchEvent",r,n==null?void 0:n.length),n){for(;n.length;){var s=n.shift();if(this.visitEnd(s,r))break}n.length=0}else this.stage.visit({reverse:!0,visible:!0,start:this.visitStart,end:this.visitEnd},r)},e.DEBUG=!1,e}();function Gt(e){e===void 0&&(e={});var t=new Kt;return t.mount(e),t.pointer=new Ut().mount(t,t.dom),t}var Kt=function(e){b(t,e);function t(){var i=e.call(this)||this;return i.canvas=null,i.dom=null,i.context=null,i.pixelWidth=-1,i.pixelHeight=-1,i.pixelRatio=1,i.drawingWidth=0,i.drawingHeight=0,i.mounted=!1,i.paused=!1,i.sleep=!1,i.mount=function(n){if(n===void 0&&(n={}),typeof n.canvas=="string"?(i.canvas=document.getElementById(n.canvas),i.canvas||console.error("Canvas element not found: ",n.canvas)):n.canvas instanceof HTMLCanvasElement?i.canvas=n.canvas:n.canvas&&console.error("Unknown value for canvas:",n.canvas),i.canvas||(i.canvas=document.getElementById("cutjs")||document.getElementById("stage")),!i.canvas){console.debug&&console.debug("Creating canvas element..."),i.canvas=document.createElement("canvas"),Object.assign(i.canvas.style,{position:"absolute",display:"block",top:"0",left:"0",bottom:"0",right:"0",width:"100%",height:"100%"});var r=document.body;r.insertBefore(i.canvas,r.firstChild)}i.dom=i.canvas,i.context=i.canvas.getContext("2d"),i.devicePixelRatio=window.devicePixelRatio||1,i.backingStoreRatio=i.context.webkitBackingStorePixelRatio||i.context.mozBackingStorePixelRatio||i.context.msBackingStorePixelRatio||i.context.oBackingStorePixelRatio||i.context.backingStorePixelRatio||1,i.pixelRatio=i.devicePixelRatio/i.backingStoreRatio,i.mounted=!0,i.requestFrame()},i.frameRequested=!1,i.requestFrame=function(){i.frameRequested||(i.frameRequested=!0,requestAnimationFrame(i.onFrame))},i._lastFrameTime=0,i._mo_touch=null,i.onFrame=function(n){if(i.frameRequested=!1,!(!i.mounted||!i.canvas||!i.context)){i.requestFrame();var r=i.canvas.clientWidth,s=i.canvas.clientHeight;(i.pixelWidth!==r||i.pixelHeight!==s)&&(i.pixelWidth=r,i.pixelHeight=s,i.drawingWidth=r*i.pixelRatio,i.drawingHeight=s*i.pixelRatio,(i.canvas.width!==i.drawingWidth||i.canvas.height!==i.drawingHeight)&&(i.canvas.width=i.drawingWidth,i.canvas.height=i.drawingHeight,console.debug&&console.debug("Resize: ["+i.drawingWidth+", "+i.drawingHeight+"] = "+i.pixelRatio+" x ["+i.pixelWidth+", "+i.pixelHeight+"]"),i.viewport({width:i.drawingWidth,height:i.drawingHeight,ratio:i.pixelRatio})));var o=i._lastFrameTime||n,h=n-o;if(!(!i.mounted||i.paused||i.sleep)){i._lastFrameTime=n,i.prerender();var f=i._tick(h,n,o);i._mo_touch!=i._ts_touch?(i._mo_touch=i._ts_touch,i.sleep=!1,i.drawingWidth>0&&i.drawingHeight>0&&(i.context.setTransform(1,0,0,1,0,0),i.context.clearRect(0,0,i.drawingWidth,i.drawingHeight),i.debugDrawAxis>0&&i.renderDebug(i.context),i.render(i.context))):f?i.sleep=!1:i.sleep=!0,E.fps=h?1e3/h:0}}},i.debugDrawAxis=0,i.label("Root"),i}return t.prototype.renderDebug=function(i){var n=typeof this.debugDrawAxis=="number"?this.debugDrawAxis:10,r=this.matrix();i.setTransform(r.a,r.b,r.c,r.d,r.e,r.f);var s=3/r.a;i.beginPath(),i.moveTo(0,0),i.lineTo(0,.8*n),i.lineTo(-.2*n,.8*n),i.lineTo(0,n),i.lineTo(.2*n,.8*n),i.lineTo(0,.8*n),i.strokeStyle="rgba(93, 173, 226)",i.lineJoin="round",i.lineCap="round",i.lineWidth=s,i.stroke(),i.beginPath(),i.moveTo(0,0),i.lineTo(.8*n,0),i.lineTo(.8*n,-.2*n),i.lineTo(n,0),i.lineTo(.8*n,.2*n),i.lineTo(.8*n,0),i.strokeStyle="rgba(236, 112, 99)",i.lineJoin="round",i.lineCap="round",i.lineWidth=s,i.stroke()},t.prototype.resume=function(){return(this.sleep||this.paused)&&this.requestFrame(),this.paused=!1,this.sleep=!1,this.publish("resume"),this},t.prototype.pause=function(){return this.paused||this.publish("pause"),this.paused=!0,this},t.prototype.touch=function(){return(this.sleep||this.paused)&&this.requestFrame(),this.sleep=!1,e.prototype.touch.call(this)},t.prototype.unmount=function(){var i;return this.mounted=!1,(i=this.pointer)===null||i===void 0||i.unmount(),this},t.prototype.background=function(i){return this.dom&&(this.dom.style.backgroundColor=i),this},t.prototype.viewport=function(i,n,r){if(typeof i>"u")return Object.assign({},this._viewport);if(typeof i=="object"){var s=i;i=s.width,n=s.height,r=s.ratio}if(typeof i=="number"&&typeof n=="number"){this._viewport={width:i,height:n,ratio:typeof r=="number"?r:1},this.viewbox();var o=Object.assign({},this._viewport);this.visit({start:function(h){if(!h._flag("viewport"))return!0;h.publish("viewport",[o])}})}return this},t.prototype.viewbox=function(i,n,r){return typeof i=="number"&&typeof n=="number"?this._viewbox={width:i,height:n,mode:r}:typeof i=="object"&&i!==null&&(this._viewbox=q({},i)),this.rescale(),this},t.prototype.camera=function(i){return this._camera=i,this.rescale(),this},t.prototype.rescale=function(){var i=this._viewbox,n=this._viewport,r=this._camera;if(n&&i){var s=n.width,o=n.height,h=Wt(i.mode)?i.mode:"in-pad",f=i.width,a=i.height;this.pin({width:f,height:a}),this.fit(s,o,h);var p=i.x||0,u=i.y||0,g=(r==null?void 0:r.a)||1,y=(r==null?void 0:r.d)||1,l=(r==null?void 0:r.e)||0,d=(r==null?void 0:r.f)||0,c=this.pin("scaleX"),v=this.pin("scaleY");this.pin("scaleX",c*g),this.pin("scaleY",v*y),this.pin("offsetX",l-p*c*g),this.pin("offsetY",d-u*v*y)}else n&&this.pin({width:n.width,height:n.height});return this},t.prototype.flipX=function(i){return this._pin._directionX=i?-1:1,this},t.prototype.flipY=function(i){return this._pin._directionY=i?-1:1,this},t}(W),vt=15;(function(e){b(t,e);function t(){var i=e.call(this)||this;return i._texture=null,i._frames=[],i._time=-1,i._repeat=0,i._index=0,i._animTickLastTime=0,i._animTick=function(n,r,s){if(!(i._time<0||i._frames.length<=1)){var o=i._animTickLastTime!=s;if(i._animTickLastTime=r,o||(i._time+=n,i._time<i._ft))return!0;var h=i._time/i._ft|0;return i._time-=h*i._ft,i.moveFrame(h),i._repeat>0&&(i._repeat-=h)<=0?(i.stop(),i._callback&&i._callback(),!1):!0}},i.label("Anim"),i._fps=vt,i._ft=1e3/i._fps,i.tick(i._animTick,!1),i}return t.prototype.renderTexture=function(i){this._texture&&this._texture.draw(i)},t.prototype.fps=function(i){return typeof i>"u"?this._fps:(this._fps=i>0?i:vt,this._ft=1e3/this._fps,this)},t.prototype.setFrames=function(i){return this.frames(i)},t.prototype.frames=function(i){return this._index=0,this._frames=st(i).array(),this.touch(),this},t.prototype.length=function(){return this._frames?this._frames.length:0},t.prototype.gotoFrame=function(i,n){return n===void 0&&(n=!1),this._index=S.wrap(i,this._frames.length)|0,n=n||!this._texture,this._texture=this._frames[this._index],n&&(this.pin("width",this._texture.getWidth()),this.pin("height",this._texture.getHeight())),this.touch(),this},t.prototype.moveFrame=function(i){return this.gotoFrame(this._index+i)},t.prototype.repeat=function(i,n){return this._repeat=i*this._frames.length-1,this._callback=n,this.play(),this},t.prototype.play=function(i){return typeof i<"u"?(this.gotoFrame(i),this._time=0):this._time<0&&(this._time=0),this.touch(),this},t.prototype.stop=function(i){return this._time=-1,typeof i<"u"&&this.gotoFrame(i),this},t})(W);(function(e){b(t,e);function t(){var i=e.call(this)||this;return i._textures=[],i.label("Monotype"),i}return t.prototype.renderTexture=function(i){if(!(!this._textures||!this._textures.length))for(var n=0,r=this._textures.length;n<r;n++)this._textures[n].draw(i)},t.prototype.setFont=function(i){return this.frames(i)},t.prototype.frames=function(i){if(this._textures=[],typeof i=="string"){var n=st(i);this._font=function(r){return n.one(r)}}else typeof i=="object"?this._font=function(r){return i[r]}:typeof i=="function"&&(this._font=i);return this},t.prototype.setValue=function(i){return this.value(i)},t.prototype.value=function(i){if(typeof i>"u")return this._value;if(this._value===i)return this;this._value=i,i===null?i="":typeof i!="string"&&!Array.isArray(i)&&(i=i.toString()),this._spacing=this._spacing||0;for(var n=0,r=0,s=0;s<i.length;s++){var o=i[s],h=this._textures[s]=this._font(typeof o=="string"?o:o+"");n+=s>0?this._spacing:0,h.setDestinationCoordinate(n,0),n=n+h.getWidth(),r=Math.max(r,h.getHeight())}return this.pin("width",n),this.pin("height",r),this._textures.length=i.length,this},t})(W);const Vt="/polymatic-example-air-traffic/assets/bg-DlvuCDqA.png",Jt="/polymatic-example-air-traffic/assets/level-one-crdm68gM.png",$t="/polymatic-example-air-traffic/assets/main-CzpAMTJY.png";class Qt extends X{constructor(){super(),this.handleActivate=async()=>{await $({name:"bg",image:{src:Vt,ratio:2}}),await $({name:"map",image:{src:Jt,ratio:2}}),await $({image:{src:$t,ratio:4},ppu:16,textures:{plane:{x:0,y:0,width:1,height:1},explode:{x:1,y:0,width:3,height:3}}}),this.context.stage=Gt(),this.emit("stage-ready")},this.on("activate",this.handleActivate)}}class qt{constructor(){this.type="delay",this.start=(t,i)=>{this.time=i.time},this.tick=(t,i)=>{t.z=0,this.time-=i,this.time<=0&&(t.action=null)}}}class L{constructor(t,i){this.point={x:0,y:0},this.angle=0,this.progress=0,this.snapshot={point:{x:0,y:0},angle:0,progress:0},this.step=n=>{this.snapshot.point.x=this.point.x,this.snapshot.point.y=this.point.y,this.snapshot.progress=this.progress;const r=.01;this.path.locate(this.progress,this.point);const s=this.point.x,o=this.point.y;this.path.locate(this.progress+r,this.point);const h=this.point.x,f=this.point.y,a=h-s,p=f-o,u=Math.sqrt(a*a+p*p)/r;return this.angle=Math.atan2(p,a),this.progress+=n*this.speed/u,this.path.locate(this.progress,this.point),this.progress>=1},this.undo=()=>{this.point.x=this.snapshot.point.x,this.point.y=this.snapshot.point.y,this.angle=this.snapshot.angle,this.progress=this.snapshot.progress},this.path=t,this.speed=i}}class ot{constructor(t){this.a={x:0,y:0},this.b={x:0,y:0},this.locate=(i,n={x:0,y:0})=>{const r=this.b.x+i*this.a.x,s=this.b.y+i*this.a.y;return n.x=r,n.y=s,n},this.b.x=t[0].x,this.b.y=t[0].y,this.a.x=t[1].x-t[0].x,this.a.y=t[1].y-t[0].y}}class Pt{constructor(t){if(this.a={x:0,y:0},this.b={x:0,y:0},this.c={x:0,y:0},this.d={x:0,y:0},this.locate=(i,n={x:0,y:0})=>{const r=i*i,s=i*i*i,o=this.a.x*s+this.b.x*r+this.c.x*i+this.d.x,h=this.a.y*s+this.b.y*r+this.c.y*i+this.d.y;return n.x=o,n.y=h,n},!t||!t.length)throw new Error("Invalid points");this.d.x=t[0].x,this.d.y=t[0].y,this.c.x=3*(t[1].x-t[0].x),this.c.y=3*(t[1].y-t[0].y),this.b.x=3*(t[2].x-t[1].x)-this.c.x,this.b.y=3*(t[2].y-t[1].y)-this.c.y,this.a.x=t[3].x-t[0].x-this.c.x-this.b.x,this.a.y=t[3].y-t[0].y-this.c.y-this.b.y}}class Zt{constructor(){this.type="enter",this.start=(t,i)=>{this.enter=i.enter},this.tick=t=>{t.position={x:this.enter.x,y:this.enter.y},t.action=null}}}class ti{constructor(){this.type="hold",this.start=(t,i)=>{},this.tick=t=>{t.z=0},this.click=t=>{t.action=null}}}class ii{constructor(){this.type="arrival",this.start=(t,i)=>{this.flyPath=new L(new Pt([t.position,t.position,{x:2*i.runway[0].x-1*i.runway[1].x,y:2*i.runway[0].y-1*i.runway[1].y},i.runway[0]]),.1),this.taxiPath=new L(new ot([i.runway[0],i.runway[1]]),.06)},this.tick=t=>{this.flyPath.progress<1?(t.z=1,t.track=this.flyPath):this.taxiPath.progress<1?(t.z=.5,t.track=this.taxiPath):(t.track=null,t.action=null)}}}class ei{constructor(){this.type="departure",this.start=(t,i)=>{this.taxiPath=new L(new ot([i.runway[0],i.runway[1]]),.09),this.flyPath=new L(new Pt([i.runway[1],{x:2*i.runway[1].x-1*i.runway[0].x,y:2*i.runway[1].y-1*i.runway[0].y},i.exit,i.exit]),.1)},this.tick=t=>{this.taxiPath.progress<1?(t.z=.5,t.track=this.taxiPath):this.flyPath.progress<1?(t.z=1,t.track=this.flyPath):(t.track=null,t.delete=!0,t.action=null)}}}class ni{constructor(){this.type="taxi",this.start=(t,i)=>{this.taxiPath=new L(new ot([t.position,i.to]),.05)},this.tick=t=>{this.taxiPath.progress<1?(t.z=0,t.track=this.taxiPath):(t.track=null,t.action=null)}}}const ri={enter:()=>new Zt,arrival:()=>new ii,departure:()=>new ei,taxi:()=>new ni,delay:()=>new qt,hold:()=>new ti};class si{constructor(){this.key="plane-"+Math.random(),this.type="plane",this.radius=120,this.position=null,this.z=0,this.angle=0,this.speed=.1,this.exploded=!1,this.actions=[],this.action=null}}class Y{static randomNumber(t,i){return typeof t>"u"?(i=1,t=0):typeof i>"u"&&(i=t,t=0),t==i?t:Math.random()*(i-t)+t}}class oi extends X{constructor(){super(),this.handleActivate=()=>{},this.handleStageReady=()=>{this.context.stage.background("#222222"),this.context.stage.viewbox(800,800,"out-crop").pin("align",-.5),this.context.stage.MAX_ELAPSE=20;const t=z("bg");t.appendTo(this.context.stage),t.pin("handle",.5);const i=z("map");i.pin({align:0,handle:.5}),i.appendTo(this.context.stage),this.context.stage.on("click",this.handleClick),this.context.stage.tick(this.handleTick)},this.handleClick=()=>{this.emit("user-click")},this.handleTick=t=>(this.emit("terminal-tick",t),this.update(),!0),this.update=()=>{this.entities.data([...this.context.items])},this.explode=t=>{const i=z("explode");i.appendTo(this.context.stage),i.rotate(Math.random()*6.28),i.pin({handle:.5,offsetX:t.x,offsetY:t.y,alpha:.1,scale:.3}),i.tween(Y.randomNumber(80,120)).pin({alpha:1,scale:.5}).tween(Y.randomNumber(250,350)).pin({alpha:.4,scale:1}).tween(Y.randomNumber(250,350)).pin({alpha:0,scale:1.5}).remove()},this.planeRender=nt.create({filter:t=>t.type==="plane",enter:t=>{let i=z("plane");return i.pin("handle",.5),i.on("click",()=>{this.emit("user-click-plane",t)}),i.appendTo(this.context.stage),i},update:(t,i)=>{t.position?(i.offset(t.position),i.rotate(t.angle),i.visible(!0)):i.visible(!1)},exit:(t,i)=>{i.remove(),t.exploded&&(this.explode(t.position),setTimeout(()=>this.explode(t.position),Math.random()*200))}}),this.entities=rt.create({key:t=>t.key}).addDriver(this.planeRender),this.on("activate",this.handleActivate),this.on("stage-ready",this.handleStageReady)}}class hi extends X{constructor(){super(),this.globalTime=0,this.nextPlaneTime=0,this.handleActivate=()=>{this.context.items=[]},this.handleTick=t=>{for(let i=0;i<this.context.items.length;i++){let n=this.context.items[i];this.takeAction(n,t)}for(let i=0;i<this.context.items.length;i++){let n=this.context.items[i];this.moveEntity(n,t)}for(let i=this.context.items.length-1;i>=0;i--)this.context.items[i].delete&&this.context.items.splice(i,1)},this.takeAction=(t,i)=>{var n;if(!t.action&&t.actions.length){const r=t.actions.shift(),s=ri[r.type];s?(t.action=s(),t.action.start(t,r)):console.log("Unknown action type",r.type)}(n=t.action)==null||n.tick(t,i)},this.handleClick=()=>{var i;const t=(i=this.context.items)==null?void 0:i.find(n=>n.type==="plane");t&&this.handleClickPlane(t)},this.handleClickPlane=t=>{var i,n;(n=(i=t.action)==null?void 0:i.click)==null||n.call(i,t)},this.moveEntity=(t,i)=>{if(t.track){t.track.step(i);for(let n=0;n<this.context.items.length;n++){let r=this.context.items[n];if(t==r)continue;const s=t.track.point.x-r.position.x,o=t.track.point.y-r.position.y;if(s*s+o*o<t.radius+r.radius){t.z==0&&r.z==0?t.track.undo():(t.exploded=!0,r.exploded=!0,t.delete=!0,r.delete=!0);return}}t.angle=t.track.angle,t.position.x=t.track.point.x,t.position.y=t.track.point.y}},this.on("activate",this.handleActivate),this.on("terminal-tick",this.handleTick),this.on("user-click-plane",this.handleClickPlane),this.on("user-click",this.handleClick)}}class ai extends X{constructor(){super(),this.globalTime=0,this.nextPlaneTime=0,this.runway=[{x:-66,y:-111},{x:132,y:-2}],this.southPoint={x:52,y:120},this.chargerPoint={x:-38,y:68},this.westPoint={x:-141,y:2},this.holdPoint={x:-78,y:-91},this.handleActivate=()=>{this.context.items=[]},this.handleTick=t=>{if(this.globalTime+=t,this.globalTime>this.nextPlaneTime){const i=this.getNextPlane();this.context.items.push(i),this.nextPlaneTime+=this.nextPlaneInterval()}},this.getNextPlane=()=>{const t=new si;return t.actions=[{type:"enter",enter:{x:-500,y:Y.randomNumber(-200,200)}},{type:"arrival",runway:this.runway},{type:"taxi",to:this.southPoint},{type:"taxi",to:this.chargerPoint},{type:"delay",time:1e3},{type:"taxi",to:this.westPoint},{type:"taxi",to:this.holdPoint},{type:"hold"},{type:"taxi",to:this.runway[0]},{type:"departure",runway:this.runway,exit:{x:500,y:Y.randomNumber(-300,300)}}],t},this.on("activate",this.handleActivate),this.on("terminal-tick",this.handleTick)}nextPlaneInterval(){return Y.randomNumber()*3e3+5e3}}class ui extends X{constructor(){super(),this.use(new Qt),this.use(new oi),this.use(new hi),this.use(new ai)}}G.activate(new ui,{});
